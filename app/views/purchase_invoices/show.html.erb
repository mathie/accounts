<h1>Purchase Invoice</h1>

<div class="row">
  <div class="span6 columns">
    <table>
      <tbody>
        <tr>
          <th>Contact</th>
          <td><%= @purchase_invoice.contact.name %></td>
        </tr>
        <tr>
          <th>Reference</th>
          <td><%= @purchase_invoice.reference %></td>
        </tr>
        <tr>
          <th>Dated on</th>
          <td><%= @purchase_invoice.dated_on %></td>
        </tr>
        <tr>
          <th>Due on</th>
          <td><%= @purchase_invoice.due_on %></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th>Category</th>
      <th class="number">Quantity</th>
      <th class="number">VAT Rate</th>
      <th class="number">Unit Price</th>
      <th class="number">Net Total</th>
    </tr>
  </thead>
  <tfoot>
    <% if @purchase_invoice.trade_discount? %>
      <tr>
        <td colspan="4" class="number">Net before trade discount</td>
        <td class="number"><%= number_to_currency @purchase_invoice.net_value_before_trade_discount %></td>
      </tr>
      <tr>
        <td colspan="4" class="number">Trade discount <%= number_to_percentage @purchase_invoice.trade_discount_percentage, strip_insignificant_zeros: true %></td>
        <td class="number"><%= number_to_currency @purchase_invoice.trade_discount %></td>
      </tr>
    <% end %>

    <tr>
      <td colspan="4" class="number">Net value</td>
      <td class="number"><%= number_to_currency @purchase_invoice.net_value %></td>
    </tr>

    <tr>
      <td colspan="4" class="number">VAT at <%= @purchase_invoice.vat_rate_percentages.map { |rate| number_to_percentage rate, strip_insignificant_zeros: true }.join(', ') %></td>
      <td class="number"><%= number_to_currency @purchase_invoice.vat_value %></td>
    </tr>

    <tr>
      <td colspan="4" class="number">Total amount payable</td>
      <td class="number"><%= number_to_currency @purchase_invoice.gross_value %></td>
    </tr>

    <% if @purchase_invoice.settlement_discount? %>
      <tr>
        <td colspan="5">
          Deduct discount of <%= number_to_percentage @purchase_invoice.settlement_discount_percentage, strip_insignificant_zeros: true %>
          if paid within <%= @purchase_invoice.payment_terms %> days.
        </td>
      </tr>
    <% end %>
  </tfoot>
  <tbody>
    <%= render @purchase_invoice.line_items %>
  </tbody>
</table>

<p>
  <%= link_to 'Edit invoice', [:edit, @purchase_invoice], class: 'btn large primary' %>
  <%= link_to 'Add line item', new_purchase_invoice_line_item_path(@purchase_invoice), class: 'btn large primary' %>
</p>